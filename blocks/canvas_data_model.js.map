{"version":3,"sources":["canvas_data_model.md"],"names":[],"mappings":"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","sourcesContent":["## Canvas Data Model\n\nAn example of using a `<canvas>` element as a data model for [`regular-table`](https://github.com/finos/regular-table).\nAs you `mouseover` the image, a cursor tooltip `<regular-table>` shows a\nzoom-in via a virtual data model which defers to [`context.getImageData()`](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData).\n\n```html\n<script src=\"/dist/umd/regular-table.js\"></script>\n<link rel='stylesheet' href=\"/dist/css/material.css\">\n```\n\n```css\nbody {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    margin: 0;\n    cursor: none;\n}\n#scroll_container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    margin: 0;\n    overflow: auto;\n}\nregular-table tbody th {\n    text-align: center;\n}\nregular-table tbody th:last-of-type,\nregular-table thead tr:first-child th\n{\n    border-right: 1px solid white;\n}\nregular-table thead tr:first-child th {\n    text-align: left;\n    padding-left: 6px;\n}\nregular-table thead tr:first-child th:first-child,\nregular-table thead tr:nth-child(2) th:nth-child(2) {\n    border-right: 1px solid white;\n}\nregular-table th:not(:first-child),\nregular-table td {\n    height: 20px !important;\n    min-width: 20px !important;\n    max-width: 20px !important;\n    padding: 0px;\n}\nregular-table th {           \n    color: white;\n    font-family: monospace;\n}\ntbody th[rowspan] {\n    vertical-align: top;\n    border-bottom: 1px solid white;\n    /* border-right: 0px !important; */\n}\nregular-table {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 400px;\n    height: 400px;\n    pointer-events: none;\n}\n\nregular-table::-webkit-scrollbar-thumb {\n    background-color: #fff !important;\n}\n#reticle {\n    position: absolute;\n    width: 20px;\n    height: 20px;\n    border: 1px solid white;\n}\n```\n\nAlternative large format images\n\n* <https://upload.wikimedia.org/wikipedia/commons/d/d6/STS120LaunchHiRes-edit1.jpg>\n* <https://upload.wikimedia.org/wikipedia/commons/7/7a/Cassius_Marcellus_Coolidge_-_Poker_Game_%281894%29.png>\n* <https://upload.wikimedia.org/wikipedia/commons/1/13/Un_bar_aux_Folies-Berg%C3%A8re_d%27E._Manet_%28Fondation_Vuitton%2C_Paris%29_%2833539037428%29.jpg>\n\n```html\n<div id=\"scroll_container\">\n    <div id=\"reticle\"></div>\n    <regular-table></regular-table>\n    <img id=\"ref_image\" crossorigin=\"anonymous\" src=\"https://upload.wikimedia.org/wikipedia/commons/7/7a/Cassius_Marcellus_Coolidge_-_Poker_Game_%281894%29.png\"></img>\n</div>\n```\n\n```javascript\nconst ref_image = document.getElementById(\"ref_image\");\nconst table = document.getElementsByTagName(\"regular-table\")[0];\nconst canvas = document.createElement(\"canvas\");\nconst scroll_container = window.scroll_container;\nconst reticle = window.reticle;\n\nconst formatter = new Intl.NumberFormat(\"en-us\");\nconst clamp = (x, y) => formatter.format(Math.floor(x / y) * y);\n\nref_image.onload = async function () {\n    canvas.width = ref_image.width;\n    canvas.height = ref_image.height;\n    const context = canvas.getContext(\"2d\");\n    context.drawImage(ref_image, 0, 0, ref_image.width, ref_image.height);\n    scroll_container.removeChild(ref_image);\n    scroll_container.appendChild(canvas);\n\n    table.addStyleListener(() => {\n        const tds = table.querySelectorAll(\"td\");\n        for (const td of tds) {\n            td.style.backgroundColor = td.textContent;\n            td.innerHTML = \" \";\n        }\n    });\n\n    const column_names = Array.from(Array(canvas.width).keys());\n\n    table.setDataListener((x0, y0, x1, y1) => {\n        const data = [];\n        for (let i = x0; i < x1; i++) {\n            const column = [];\n            data.push(column);\n            for (let j = y0; j < y1; j++) {\n                const [r, g, b] = context.getImageData(i, j, 1, 1).data;\n                column.push(`rgb(${r},${g},${b})`);\n            }\n        }\n        return {\n            data,\n            row_headers:\n                y1 - y0 === 0\n                    ? []\n                    : Array.from(Array(Math.floor(y1 - y0)).keys()).map((z) => [\n                          clamp(y0 + z, 10),\n                          (y0 + z) % 10,\n                      ]),\n            column_headers: column_names\n                .slice(x0, x1)\n                .map((x) => [clamp(x, 10), x % 10]),\n            num_rows: canvas.height,\n            num_columns: column_names.length,\n        };\n    });\n\n    await table.draw();\n};\n\nif (ref_image.complete || ref_image.naturalWidth > 0) {\n    ref_image.onload();\n}\n\nwindow.addEventListener(\"mousemove\", (event) => {\n    const x = event.clientX + scroll_container.scrollLeft;\n    const y = event.clientY + scroll_container.scrollTop;\n    reticle.style.top = `${y}px`;\n    reticle.style.left = `${x}px`;\n    const top_scroll_limit =\n        scroll_container.scrollTop + window.innerHeight - 424;\n    const left_scroll_limit =\n        scroll_container.scrollLeft + window.innerWidth - 424;\n    if (top_scroll_limit < y + 20 && left_scroll_limit < x + 20) {\n        if (y - top_scroll_limit < x - left_scroll_limit) {\n            table.style.top = `${top_scroll_limit}px`;\n            table.style.left = `${x - 424}px`;\n        } else {\n            table.style.top = `${y - 424}px`;\n            table.style.left = `${left_scroll_limit}px`;\n        }\n    } else {\n        table.style.top = `${Math.min(top_scroll_limit, y + 20)}px`;\n        table.style.left = `${Math.min(left_scroll_limit, x + 20)}px`;\n    }\n    table.scrollToCell(x, y, canvas.width, canvas.height);\n});\n```\n\n"]}